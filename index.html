<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js ui-helper-reset"> <!--<![endif]-->
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>KivaSort</title>
<meta name="description" content="A table of Kiva's field partners which may be sorted and filtered.">
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Place favicon.ico and apple-touch-icon.png in the root directory -->

<link rel="stylesheet" href="css/combined.css">

</head>
<body class='ui-widget'>
<!--[if lt IE 7]>
            <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->

<!-- Add your site or application content here -->

<h1>KivaSort</h1>
<div class="ui-widget ui-state-default" id="loading"><p>Loading table &nbsp; <img alt='...' src='./ajax-loader.gif'></p></div>
<div id="tabs">
    <ul>
        <li id='fpd_link'><a href="#data">Field Partner Data</a></li>
        <li><a href="#about">About</a></li>
        <li><a href="#support">Support</a></li>
    </ul>
    <div id="data" class='tab_content'>
        <label><input id='hideIncomplete' type='checkbox' value='doHide' checked />Hide field partners with incomplete data</label><br/>
        <table id="KivaSort" class="display no-wrap" style="width: 100%">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Portfolio Yield</th>
                    <th>Profitability</th>
                    <th>Currency Exchange Loss Rate</th>
                    <th>Total Amount Raised</th>
                    <th>Loans Posted</th>
                    <th>Delinquency Rate</th>
                    <th>Default Rate</th>
                    <th>Rating</th>
                    <th>Average Loan Size Percent Per Capita Income</th>
                    <th>Loans At Risk Rate</th>
                    <th>Status</th>
                    <th>Start Date</th>
                    <th>Country</th>
                    <th>URL</th>
                </tr>
            </thead>
        </table>
    </div>
    <div id="about" class="tab_content">
        <h2>What is it?</h2>
        <p>A table of <a href='http://kiva.com/'>Kiva's</a> field partners (the microfinance organizations which administer loans made possible by Kiva) which may be sorted and filtered.

        <h2>Motivation</h2>
        <p>I created KivaSort to complement an essay I wrote called <a href='https://americancynic.net/log/2018/12/3/kivas_interest_rates/'>Microfinance and the re-exploitation of women: Some thoughts on Kiva's interest rates</a>.
        <p>Most of Kiva's field partners collect interest on the loans they disburse. The rates of interest vary, but they are sometimes very high despite the fact that much of the risk and cost is offloaded to Kiva and Kiva's generous users. Identifying field partners with high (or low) interest would be easiest if they could all be sorted by their "<a href='https://www.kiva.org/help/solution/average_cost_to_borrower_p_y'>Portfolio Yield</a>" (average interest rates) and "<a href='https://www.kiva.org/help/solution/what_does_profitability_return_on_assets_mean'>Profitability</a>" (return on assets) metrics. The higher those rates, the higher the interest will tend to be on loans from those lenders. Providing the ability to sort the list of Kiva's field partners in such a way is the main motivating force behind the creation of KivaSort.
        <p>Kiva provides a table of field partners on their web site, but it has limited sorting options (it cannot be sorted by portfolio yield, for example). Kiva does provide <a href='http://build.kiva.org/'>nice APIs</a> for their various services, which KivaSort uses.

        <h3>Further reading</h3>
        <ul>
            <li><a href='https://americancynic.net/log/2018/12/6/some_thoughts_on_kivas_interest_rates/'>Some thoughts on Kiva's interest rates</a>
            <li><a href='https://web.archive.org/web/20150104215222/http://blog.microfinancetransparency.com/whats-wrong-with-kivas-portfolio-yield-statistic/' title='What’s Wrong With Kiva’s Portfolio Yield Statistic?'>"What’s Wrong With Kiva’s Portfolio Yield Statistic?" by Hugh Sinclair</a></li>
            <li><a href='https://books.google.com/books/about/Seduced_and_Betrayed.html?id=h5cRvgAACAAJ'>Seduced and Betrayed: Exposing the Contemporary Microfinance Phenomenon</a> Edited by Milford Bateman and Kate Mclean (Santa Fe: School for Advanced Research Press, 2017) is the most complete single-volume criticism of microfinance that I know of.</li>
        </ul>
        <h3>See also</h3>
        <ul>
            <li><a href='https://www.kiva.org/about/where-kiva-works'>Kiva.org's table of field partners</a></li>
            <li><a href='http://kivalens.org/'>KivaLens.org</a> - KivaLens has now been rewritten in JavaScript and runs well in all modern browsers. Unlike KivaSort, it is a full-featured Kiva app geared toward heavy lenders who wish to carefully vet their borrowers. Like KivaSort, it allows Kiva's list of field partners to be filtered by various criteria.</li>
            <li><a href='http://kivatools.com/partners'>Kiva Tools</a> - Kiva Tools is another little app I discovered after creating KivaSort which allows Kiva field partners to be searched and sorted.</li>
        </ul>

        <h2>Hints on Using KivaSort</h2>
        <p>By default, KivaSort lists field partners ordered primarily by "Portfolio Yield" so that field partners with low interest rates will be near the top. But note that expensive loans do not necessarily indicate usurious loans (at least not more usurious than other lenders); some locations have legitimately high costs associated with administering loans due to such factors as social instability, inflation, and lack of infrastructure. In that respect, a high "Profitability" metric may be the best way to identify highly exploitative lenders &mdash; although a consistently negative "Profitability" may indicate a non-sustainable field partner.
        <p>Hopefully the various controls for filtering, sorting, and exporting the table data are self-explanatory. Here are a few tips:

        <ul>
            <li>Click a column header to sort in ascending order. Click again to sort in descending order.</li>
            <li>Hold down shift and click column headers to sort by multiple columns simultaneously.</li>
            <li>Columns that do not fit on the screen can be displayed as sub-rows by clicking the green icon in the first column.</li>
            <li>Type a [partial] word in the "Search" box to filter the table down to only rows containing the search term(s) in any column.</li>
            <li>Every column has a filter widget (search box, slider, etc.) which can be used to filter the table based on the data in that particular column.
            <li>The "Column visibility" button can be used to hide columns.</li>
            <li>The "Export" button allows you to copy the table data to the clipboard or download it as a CSV-formatted file. Only the non-hidden columns will included in the exported data</li>
            <li>The "Reload" button will re-fetch the most current data from Kiva and refresh the table's contents with it.</li>
            <li>Uncheck the "Hide field partners with incomplete data" to show field partners who do not have some data (such as Portfolio Rate). Missing data is displayed as "-" in the table.</li>
        </ul>

        <h2>Open Source</h2>
        <p>The KivaSort web site is completely open source. If you'd like to view or contribute to the project, please take a look at the public git repository:
            <ul>
                <li><a href='https://github.com/cristoper/kivasort.americancynic.net'>https://github.com/cristoper/kivasort.americancynic.net</a></li>
                <li><a href='https://github.com/cristoper/jquery-KivaSort/'>JQuery-KivaSort</a> - a JQuery plugin which fetches field partner data from Kiva and wraps it in a sortable DataTable. This plugin is based on the <a href='https://datatables.net/'>DataTables jQuery plugin</a> which does all of the hard work of making an HTML table dynamic.</li>
            </ul>

        <h2>Who?</h2>
        <p>KivaSort.americancynic.net and the KivaSort JQuery plugin were created and are maintained by <a href='https://github.com/cristoper'>chris burkhardt</a> &lt;<a href='mailto:chris@mretc.net'>chris@mretc.net</a>&gt;.
    </div>

    <div id="support" class="tab_content">
        <p>I write small, Free software and radical social commentary. If you found KivaSort helpful, please consider making a small contribution to further my work on this and similar projects.
        <ul>
            <li>Support my work by sending a couple dollars via PayPal: <a href='https://paypal.me/cristoper/5' title='Make donation to author via PayPal'>donate to cris@mretc.net</a></li>
            <li>Support my writing <a href='https://www.patreon.com/acynic'>via Patreon</a></li>
        </ul>
    </div>
</div>

<script type="text/javascript" src="https://code.jquery.com/jquery-1.12.0.min.js"></script>

<script type="text/javascript" src="js/combined.js"></script>

<script type="text/javascript">
// Change m4 quotes to something that doesn't ruin syntax highlighting or
// interfere with the rest of the file:
//
$(document).ready(function () {

    window.onpopstate = function(event) {
        // Change tabs on back/forward buttons
        var hash = $(window.location.hash);
        if (window.location.hash == "") {
            hash = $("#data");
        }
        var index = hash.index() - 1;
        $('#tabs').tabs('option', 'active', index);
    };

    var kivaTable = $('#KivaSort');
    var dTable;
    $('#tabs').tabs({
        activate: function(e, ui) {

            /* Update URL bar to allow bookmarking of tabs and back/forward
             * buttons in browsers which support the History API */

            var hash = ui.newPanel.attr('id');

            if (e.originalEvent && e.originalEvent.type == "click") {
                if (window.location.protocol != "file:" && history.pushState) {
                    history.pushState(null, null, '#' + hash);
                } else {
                    /* At least allow non-History API browsers to bookmark tabs
                     * The scrollmem stuff is to prevent scrolling when setting the id
                     * fragment (see http://stackoverflow.com/a/3041606/408930) */
                    var scrollmem = $('html,body').scrollTop();
                    window.location.hash = hash;
                    $('html,body').scrollTop(scrollmem);
                }
            }

            if (ui.newTab.is($('#fpd_link'))) {
                // If the user is on a different tab when the table data loads,
                // then the Responsive plugin will not calculate column widths
                // correctly. So we recalculate them when the tab becomes
                // visible.
                dTable.responsive.recalc();

                // Re-enable the fixed header
                dTable.fixedHeader.enable(true);
            } else {
                // remove fixed header when viewing other tabs
                dTable.fixedHeader.enable(false);
            }
        },
        create: function() {
            $('#tabs').show();
            $('#loading').hide();
        }
    });

    kivaTable.on('init.dt', function(e, s, b) {
        // Keep reference to DataTable
        dTable = kivaTable.DataTable();

        // Initially hide/show incomplete rows based on HTML
        toggleIncomplete($('#hideIncomplete').is(':checked'));
    });

    kivaTable.on('xhr.dt', function() {
        $('#loading').hide();
    });

    kivaTable.on('preXhr.dt', function(e, s, b) {
        // Style the loading row
        var loading = $('#loading');
        var loadrow = $('#loadingrow');
        var datadiv = $('#data');
        loadrow.css('width', datadiv.width());
        datadiv.append(loading.show());
    });

    kivaTable.makeKivaTable({
        deferRender: true,
        responsive: true,
        fixedHeader: true,
        columnFilters: {
            2: {type: "range", suffix: "%"},
            3: {type: "range", suffix: "%", numSteps: 15},
            4: {type: "range", suffix: "%"},
            5: {type: "range", prefix: "$", numSteps: 50},
            6: {type: "range", numSteps: 20},
            7: {type: "range", suffix: "%"},
            8: {type: "range", suffix: "%"},
            9: {type: "select"},
            10: {type: "range", suffix: "%", numSteps: 25},
            11: {type: "range", suffix: "%"},
            12: "select"
        },
        lengthMenu: [ [10, 25, 50, -1], [10, 25, 50, "All"] ],
        dom: 'Bftip',
        language: {
            buttons: {
                pageLength: { '-1': "Show all rows", _: "Show %d rows/page" }
            },
            loadingRecords: '<div id="loadingrow">...</a>'
        },
        buttons: [
            'pageLength',
            'colvis',  
            { extend: 'collection', text: 'Export',
                buttons: [
                    { extend: 'copy',
                        text: 'Copy to Clipboard',
                        exportOptions: {columns: ':visible'}
                    },
                    { extend: 'csv',
                        text: 'Download as CSV',
                        exportOptions: {columns: ':visible'}
                    },
                    { extend: 'json',
                        text: 'View source JSON' }
                ]
            }, 'reload'],

            /** To use the cached json file, run make with 'NO_AJAX=y' */
            

            /* Let Kiva know who is using their API */
            ks_appID: 'net.americancynic.kivasort',

            /* Sort by Portfolio Yield, then Profitability */
            order: [[2, "asc"], [3, "asc"], [4, "desc"], [5, "desc"]]
    });

    function toggleIncomplete(isChecked) {
        if (isChecked) {
            dTable.columns().search('^(?!-$)', true, false).draw();
        } else{
            dTable.columns().search('', false, false).draw();
        }
    }

    // hide/show incomplete rows whenever checkbox is clicked
    $('#hideIncomplete').click(function() {
        toggleIncomplete(this.checked);
    });

});

</script>

</body>
</html>
